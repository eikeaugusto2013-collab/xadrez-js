<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Xadrez Minimax</title>
<style>
body {
  background:#222;
  color:white;
  display:flex;
  flex-direction:column;
  align-items:center;
  font-family:Arial;
}

#board {
  display:grid;
  grid-template-columns:repeat(8,70px);
  grid-template-rows:repeat(8,70px);
  border:4px solid #000;
  margin-top:20px;
}

.cell {
  width:70px;
  height:70px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:44px;
  cursor:pointer;
  position:relative;
}

.white { background:#f0d9b5; }
.black { background:#b58863; }

.dot {
  width:18px;
  height:18px;
  background:rgba(0,0,0,0.4);
  border-radius:50%;
  position:absolute;
}

.selected {
  outline:4px solid red;
}

#info { margin-top:15px; }
button { margin-top:10px; padding:8px 14px; }
</style>
</head>

<body>

<h1>Xadrez ♟️</h1>
<div id="board"></div>
<div id="info"></div>
<button onclick="resetGame()">Reiniciar</button>

<script>
const PIECES = {
  r:"♜", n:"♞", b:"♝", q:"♛", k:"♚", p:"♟",
  R:"♖", N:"♘", B:"♗", Q:"♕", K:"♔", P:"♙"
};

let board, turn, selected, legalMoves;

function resetGame() {
  board = [
    "rnbqkbnr",
    "pppppppp",
    "........",
    "........",
    "........",
    "........",
    "PPPPPPPP",
    "RNBQKBNR"
  ].map(r=>r.split(""));
  turn = "white";
  selected = null;
  legalMoves = [];
  draw();
  info("Sua vez");
}

function draw() {
  const b = document.getElementById("board");
  b.innerHTML="";
  for(let r=0;r<8;r++)for(let c=0;c<8;c++){
    const d=document.createElement("div");
    d.className="cell "+((r+c)%2?"black":"white");
    const p=board[r][c];
    if(p!=".") d.textContent=PIECES[p];
    d.onclick=()=>click(r,c);
    if(selected && selected.r===r && selected.c===c)
      d.classList.add("selected");
    legalMoves.forEach(m=>{
      if(m.r===r && m.c===c){
        const dot=document.createElement("div");
        dot.className="dot";
        d.appendChild(dot);
      }
    });
    b.appendChild(d);
  }
}

function click(r,c){
  if(turn!=="white")return;
  const p=board[r][c];
  if(selected){
    if(legalMoves.some(m=>m.r===r&&m.c===c)){
      move(selected.r,selected.c,r,c);
      turn="black";
      draw();
      setTimeout(aiMove,300);
    }
    selected=null;
    legalMoves=[];
  } else if(p!="." && p===p.toUpperCase()){
    selected={r,c};
    legalMoves=genMoves(r,c);
  }
  draw();
}

function move(r1,c1,r2,c2){
  board[r2][c2]=board[r1][c1];
  board[r1][c1]=".";
  // promoção
  if(board[r2][c2]==="P" && r2===0){
    const choice=prompt("Promover para Q,R,B,N","Q");
    board[r2][c2]=choice||"Q";
  }
}

function genMoves(r,c){
  const p=board[r][c];
  const moves=[];
  const dir=p==="P"?-1:1;
  if(p.toLowerCase()==="p"){
    if(board[r+dir]?.[c]===".") moves.push({r:r+dir,c});
    [-1,1].forEach(dc=>{
      if(board[r+dir]?.[c+dc] && board[r+dir][c+dc]!=".")
        moves.push({r:r+dir,c:c+dc});
    });
  }
  return moves;
}

function aiMove(){
  let best=null;
  let bestScore=-9999;
  for(let r=0;r<8;r++)for(let c=0;c<8;c++){
    if(board[r][c]===board[r][c].toLowerCase()){
      genMoves(r,c).forEach(m=>{
        const captured=board[m.r][m.c];
        board[m.r][m.c]=board[r][c];
        board[r][c]=".";
        const score=evaluate();
        board[r][c]=board[m.r][m.c];
        board[m.r][m.c]=captured;
        if(score>bestScore){
          bestScore=score;
          best={r,c,m};
        }
      });
    }
  }
  if(best){
    move(best.r,best.c,best.m.r,best.m.c);
    turn="white";
    draw();
  }
}

function evaluate(){
  const val={p:1,n:3,b:3,r:5,q:9,k:100};
  let s=0;
  for(let r=0;r<8;r++)for(let c=0;c<8;c++){
    const p=board[r][c];
    if(p!=".") s+=(p===p.toLowerCase()?1:-1)*val[p.toLowerCase()];
  }
  return s;
}

function info(t){document.getElementById("info").textContent=t;}

resetGame();
</script>
</body>
</html>
