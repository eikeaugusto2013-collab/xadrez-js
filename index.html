<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Xadrez Completo</title>
<style>
body{margin:0;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;background:#222;font-family:Arial}
.board{display:grid;grid-template-columns:repeat(8,64px);grid-template-rows:repeat(8,64px);border:4px solid #000}
.cell{display:flex;justify-content:center;align-items:center;cursor:pointer;user-select:none;position:relative}
.white{background:#f0d9b5}
.black{background:#b58863}
.selected{outline:3px solid red}
.hint::after{content:"";width:18px;height:18px;border-radius:50%;background:rgba(0,0,0,.35);position:absolute}
.turn,.msg{color:#fff;margin:6px}
button{margin-top:8px;padding:6px 14px;font-size:14px;cursor:pointer}
.log{color:#ddd;max-height:140px;overflow:auto;font-size:13px;margin-top:6px;width:520px}
img{width:48px;height:48px;pointer-events:none}
</style>
</head>
<body>

<div class="turn" id="turn"></div>
<div class="msg" id="msg"></div>
<div class="board" id="board"></div>
<button onclick="resetGame()">Reiniciar partida</button>
<div class="log" id="log"></div>

<script>
const boardEl=document.getElementById('board');
const turnEl=document.getElementById('turn');
const msgEl=document.getElementById('msg');
const logEl=document.getElementById('log');

const pieces={
  p:"peao1.png", r:"torre1.png", n:"cavalo1.png", b:"bispo1.png", q:"rainha1.png", k:"rei1.png",
  P:"peao2.png", R:"torre2.png", N:"cavalo2.png", B:"bispo2.png", Q:"rainha2.png", K:"rei2.png"
};

const initialState=["rnbqkbnr","pppppppp","........","........","........","........","PPPPPPPP","RNBQKBNR"];
let state=[], turn='white', selected=null, lastMove=null, gameOver=false;

const isWhite=p=>p>='A'&&p<='Z';
const cloneState=s=>s.map(r=>r);

function draw(){
  boardEl.innerHTML='';
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      const cell=document.createElement('div');
      cell.className='cell '+(((r+c)%2===0)?'white':'black');
      cell.dataset.r=r;
      cell.dataset.c=c;

      const p=state[r][c];
      if(p!=='.'){
        const img=document.createElement('img');
        img.src=pieces[p];
        cell.appendChild(img);
      }

      cell.onclick=()=>onClick(cell);
      boardEl.appendChild(cell);
    }
  }
  turnEl.textContent=gameOver?'Partida encerrada':'Vez: '+(turn==='white'?'Brancas':'Pretas');
}

function onClick(cell){
  if(turn!=='white'||gameOver)return;
  const r=+cell.dataset.r,c=+cell.dataset.c,p=state[r][c];

  if(selected){
    const fr=+selected.dataset.r,fc=+selected.dataset.c;
    if(validMove(state,state[fr][fc],fr,fc,r,c)){
      makeMove(state,fr,fc,r,c);
      selected.classList.remove('selected');
      selected=null;
      draw();
      turn='black';
      setTimeout(aiMove,300);
      return;
    }
    selected.classList.remove('selected');
    selected=null;
  }

  if(p!=='.'&&isWhite(p)){
    selected=cell;
    cell.classList.add('selected');
  }
}

function makeMove(s,fr,fc,tr,tc){
  const p=s[fr][fc];
  s[fr]=s[fr].substring(0,fc)+'.'+s[fr].substring(fc+1);
  s[tr]=s[tr].substring(0,tc)+p+s[tr].substring(tc+1);
}

function validMove(s,p,fr,fc,tr,tc){
  if(fr===tr&&fc===tc)return false;
  const t=s[tr][tc];
  if(t!=='.'&&isWhite(t)===isWhite(p))return false;

  const dr=tr-fr, dc=tc-fc;

  switch(p.toLowerCase()){
    case 'p':{
      const d=isWhite(p)?-1:1;
      if(dc===0&&t==='.'&&dr===d)return true;
      if(dc===0&&t==='.'&&dr===2*d&&((isWhite(p)&&fr===6)||(!isWhite(p)&&fr===1)))return true;
      if(Math.abs(dc)===1&&dr===d&&t!=='.')return true;
      return false;
    }
    case 'r': return dr===0||dc===0;
    case 'n': return (Math.abs(dr)===2&&Math.abs(dc)===1)||(Math.abs(dr)===1&&Math.abs(dc)===2);
    case 'b': return Math.abs(dr)===Math.abs(dc);
    case 'q': return dr===0||dc===0||Math.abs(dr)===Math.abs(dc);
    case 'k': return Math.abs(dr)<=1&&Math.abs(dc)<=1;
  }
  return false;
}

function aiMove(){
  let moves=[];
  for(let r=0;r<8;r++)for(let c=0;c<8;c++){
    const p=state[r][c];
    if(p!=='.'&&!isWhite(p)){
      for(let tr=0;tr<8;tr++)for(let tc=0;tc<8;tc++){
        if(validMove(state,p,r,c,tr,tc))moves.push({r,c,tr,tc});
      }
    }
  }
  if(!moves.length)return;
  const m=moves[Math.floor(Math.random()*moves.length)];
  makeMove(state,m.r,m.c,m.tr,m.tc);
  turn='white';
  draw();
}

function resetGame(){
  state=cloneState(initialState);
  turn='white';
  selected=null;
  gameOver=false;
  draw();
}

resetGame();
</script>
</body>
</html>

